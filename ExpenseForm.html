<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: 'Segoe UI', Arial, sans-serif;
        background: #f9fbfd;
        margin: 0;
        padding: 6px;
      }

      #expenseForm {
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 1px 4px #e0e3e8;
        padding: 14px;
        max-width: 240px;
        margin: 0 auto;
      }

      label {
        font-weight: 500;
        display: block;
        margin-bottom: 3px;
        color: #215368;
        font-size: 13px;
      }

      input, select, textarea {
        width: 100%;
        padding: 6px;
        margin-bottom: 12px;
        border: 1px solid #d0d4da;
        border-radius: 4px;
        font-size: 13px;
        box-sizing: border-box;
        background: #fbfcfe;
      }

      textarea {
        resize: vertical;
        min-height: 30px;
        max-height: 60px;
      }

      input[readonly], select:disabled {
        background: #f2f4f7;
        color: #555;
      }

      button {
        background: #215368;
        color: #fff;
        border: none;
        padding: 8px 14px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        width: 100%;
      }

      button:hover {
        background: #17384a;
      }

      #message {
        margin-top: 10px;
        font-size: 13px;
        font-weight: 500;
        text-align: center;
        color: #215368;
      }
    </style>
  </head>

  <body>
    <form id="expenseForm">

      <label>Date</label>
      <input type="date" name="date" id="date" required>

      <label>Expense Name</label>
      <select name="expenseName" id="expenseName" required></select>
      
      <label>Amount</label>
      <input type="number" name="amount" required>

      <label>Category</label>
      <select id="category" disabled></select>

      <label>Sub-Category</label>
      <input type="text" id="subCategory" readonly>

      <label>Payment Method</label>
      <select name="paymentMethod" id="paymentMethod"></select>

      <label>Expense Nature</label>
      <input type="text" id="expenseNature" readonly>

      <label>Notes</label>
      <textarea name="notes"></textarea>

      <button type="submit">Add Expense</button>
    </form>

    <div id="message"></div>

    <script>
      // Set today's date
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('date').value =
          new Date().toISOString().substring(0, 10);

        google.script.run
          .withSuccessHandler(populateDropdowns)
          .getDropdownOptions();
      });

      // Populate all dropdowns based on selections
      function populateDropdowns(options) {
        const expenseSelect = document.getElementById('expenseName');
        const categorySelect = document.getElementById('category');
        const paymentSelect = document.getElementById('paymentMethod');

        expenseSelect.innerHTML = '<option value="">Select...</option>';
        categorySelect.innerHTML = '';
        paymentSelect.innerHTML = '';

        options.expenseNames.forEach(v =>
          expenseSelect.add(new Option(v, v))
        );

        options.categories.forEach(v =>
          categorySelect.add(new Option(v, v))
        );

        options.payment.forEach(v =>
          paymentSelect.add(new Option(v, v))
        );
      }

      document
        .getElementById('expenseName')
        .addEventListener('change', function () {
          const expenseName = this.value;
          if (!expenseName) return;

          google.script.run
            .withSuccessHandler(data => {
              document.getElementById('category').value = data.category || '';
              document.getElementById('subCategory').value = data.subCategory || '';
              document.getElementById('paymentMethod').value = data.payment || '';
              document.getElementById('expenseNature').value = data.nature || '';
            })
            .getExpenseDetails(expenseName);
        });

      document
        .getElementById('expenseForm')
        .addEventListener('submit', e => {
          e.preventDefault();

          const formData = Object.fromEntries(
            new FormData(e.target).entries()
          );

          google.script.run
            .withSuccessHandler(msg => {
              document.getElementById('message').textContent = msg;
              e.target.reset();
              document.getElementById('date').value =
                new Date().toISOString().substring(0, 10);
            })
            .saveExpense(formData);
        });
    </script>
  </body>
</html>
